<script type="text/javascript" src="../../static/MochiKit/MochiKit.js"></script>
<script type="text/javascript">
MochiKit.DOM.addLoadEvent(location = "../../#config-rss");
</script>
<h2>RSS Configuration</h2>
<!--#if $have_feedparser#-->

<div class="EntryBlock" id="add_rss_feed">
<fieldset class="EntryFieldSet">
<legend>New feed URI</legend>

    <input type="text" size="10" name="feed" value="$feed"/>
    <input type="text" size="80" name="uri" value=""/>
    <input type="hidden" name="session" value="$session">
    <input type="submit" value="Add" onclick="javascript:submitconfig('config/rss/add_rss_feed', '','add_rss_feed', '1')"   />
</fieldset>
</div>

<p>The checkbox next to the feed name should be ticked for the feed to be enabled and be automatically checked for new items.<br />
The checking frequency is in the General page of the configuration<br />
When a feed is added, it will only pick up new items and not anything already in the RSS feed unless you press "Force Download"</p>
<!--#for $feed in $rss#-->
<br class="clear" />
<fieldset class="EntryFieldSet">
    <legend <!--#if $rss[$feed]['enable'] then 'class="feedEnabled"' else 'class="feedDisabled"'#-->><input type="checkbox" onclick="javascript:submitconfig('config/rss/toggle_rss_feed', '','update_$feed','1' )"  name="enable" <!--#if $rss[$feed]['enable'] then "CHECKED" else "" #-->/> Feed $feed</legend>
    <hr />
    <div class="EntryBlock" id="update_$feed">

            <input type="text" size="92" name="uri" value="$rss[$feed]['uri']"/>
            <input type="hidden" name="session" value="$session">
            <input type="submit" onclick="javascript:submitconfig('config/rss/del_rss_feed', '','update_$feed','1' )" value="Delete Feed"/>
            <input type="submit" onClick="javascript:location='./config/rss/test_rss_feed?feed=$feed&session=$session'" value="Preview"/>
            <input type="submit" onClick="javascript:location='./config/rss/download_rss_feed?feed=$feed&session=$session'" value="Force-Download"/>
            <br/><br/>

            <!--#if $rss[$feed]['pick_cat']#-->
                <select name="cat">
                <!--#for $ct in $cat_list#-->
                    <option value="$ct" <!--#if $ct == $rss[$feed]['cat'] then "selected" else ""#-->>$ct</option>
                <!--#end for#-->
                </select>
            <!--#end if#-->
            <select name="pp">
                <option value="" <!--#if $rss[$feed]['pp'] == "" then 'selected' else ''#-->>Default</option>
                <option value="0" <!--#if $rss[$feed]['pp'] == "0" then 'selected' else ''#-->>Download</option>
                <option value="1" <!--#if $rss[$feed]['pp'] == "1" then 'selected' else ''#-->>+Repair</option>
                <option value="2" <!--#if $rss[$feed]['pp'] == "2" then 'selected' else ''#-->>+Unpack</option>
                <option value="3" <!--#if $rss[$feed]['pp'] == "3" then 'selected' else ''#-->>+Delete</option>
            </select>
            <!--#if $rss[$feed]['pick_script']#-->
                <select name="script">
                <!--#for $sc in $script_list#-->
                    <option value="$sc" <!--#if $sc == $rss[$feed]['script'] then "selected" else ""#-->>$sc</option>
                <!--#end for#-->
                </select>
            <!--#end if#-->
            <input type="hidden" name="feed" value="$feed"/>
            <!--<input type="checkbox" onclick="javascript:submitconfig('config/rss/toggle_rss_feed', '','update_$feed','1' )"  name="enable" <!--#if $rss[$feed]['enable'] then "CHECKED" else "" #-->/>Scheduled -->
            <input type="submit" value="Save" onclick="javascript:submitconfig('config/rss/upd_rss_feed', 'session=$session','update_$feed','1' )" />

        </fieldset>

    </div>
    <br/>

    <table id="rssTable">
    <thead>
        <tr>
            <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
            <th>Order</th>
            <th>Type</th>
            <th>Filter</th>
            <!--#if $rss[$feed]['pick_cat'] then "<th>Category</th>" else ""#-->
            <th>Mode</th>
            <!--#if $rss[$feed]['pick_script'] then "<th>Script</th>" else ""#-->
            <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        </tr>
    </thead>
    <tbody>
    <tr id="$feed+new_filter">
        <td></td>
        <td></td>
        <td>
            <select name="filter_type">
                <option value="A" selected /> Accept</option>
                <option value="R" /> Reject</option>
            </select>
        </td>
        <td><input type="text" size="40" class="filter_text" name="filter_text" value=""></td>
        <!--#if $rss[$feed]['pick_cat']#-->
          <td>
            <select name="cat">
            <!--#for $ct in $cat_list#-->
                <option value="$ct" <!--#if $ct == $rss[$feed]['cat'] then "selected" else ""#-->>$ct</option>
            <!--#end for#-->
            </select>
          </td>
        <!--#end if#-->
        <td>
          <select name="pp">
              <option value="" <!--#if $rss[$feed]['pp'] == "0" then 'selected' else ''#-->>Default</option>
              <option value="0" <!--#if $rss[$feed]['pp'] == "0" then 'selected' else ''#-->>Download</option>
              <option value="1" <!--#if $rss[$feed]['pp'] == "1" then 'selected' else ''#-->>+Repair</option>
              <option value="2" <!--#if $rss[$feed]['pp'] == "2" then 'selected' else ''#-->>+Unpack</option>
              <option value="3" <!--#if $rss[$feed]['pp'] == "3" then 'selected' else ''#-->>+Delete</option>
          </select>
        </td>
        <!--#if $rss[$feed]['pick_script']#-->
          <td>
            <select name="script">
            <!--#for $sc in $script_list#-->
                <option value="$sc" <!--#if $sc == $rss[$feed]['script'] then "selected" else ""#-->>$sc</option>
            <!--#end for#-->
            </select>
          </td>
        <!--#end if#-->
        <td>
        <input type="hidden" value="$rss[$feed]['filtercount']" name="index">
        <input type="hidden" value="$feed" name="feed">
        <input type="hidden" name="session" value="$session">
        <input type="submit" value="Add"  onclick="javascript:submitconfig('config/rss/upd_rss_filter', '','$feed+new_filter','1' )">
        </td>
    </tr>



    <!--#set $fnum = 0#-->


    <!--#for $filter in $rss[$feed].filters#-->
    <tr class="odd" id="$feed+$fnum">
        <td>
            <input type="submit" value="X" onclick="javascript:lr('config/rss/del_rss_filter','session=$session&index=$fnum&feed=$feed')" />
        </td>

        <td>
        <select onChange="javascript:changequeuedetails('config/rss/'+this.options[this.selectedIndex].value, 'session=$session');">
        <!--#for $i in xrange($rss[$feed]['filtercount'])#-->
            <option value="pos_rss_filter?feed=$feed&current=$fnum&new=$i" <!--#if int($i) == int($fnum) then "selected" else ""#-->>$i</option>
        <!--#end for#-->
        </select>
        </td>


        <td>
        <select name="filter_type">
            <option value="A" <!--#if $filter[3] == "A" then "selected" else ""#--> /> Accept</option>
            <option value="R" <!--#if $filter[3] == "R" then "selected" else ""#--> /> Reject</option>
        </select>
        </td>

        <td><input type="text" size="40" class="filter_text" name="filter_text" value="$filter[4]"/></td>
        <!--#if $rss[$feed]['pick_cat']#-->
          <td>
            <select name="cat">
            <!--#for $ct in $cat_list#-->
                <option value="$ct" <!--#if $ct == $filter[0] then "selected" else ""#-->>$ct</option>
            <!--#end for#-->
            </select>
          </td>
        <!--#end if#-->

            <td>
                <select name="pp">
                    <option value="" <!--#if $filter[1] == "0" then 'selected' else ''#-->>Default</option>
                    <option value="0" <!--#if $filter[1] == "0" then 'selected' else ''#-->>Download</option>
                    <option value="1" <!--#if $filter[1] == "1" then 'selected' else ''#-->>+Repair</option>
                    <option value="2" <!--#if $filter[1] == "2" then 'selected' else ''#-->>+Unpack</option>
                    <option value="3" <!--#if $filter[1] == "3" then 'selected' else ''#-->>+Delete</option>
                </select>
            </td>
        <!--#if $rss[$feed]['pick_script']#-->
            <td>
            <select name="script">
            <!--#for $sc in $script_list#-->
                <option value="$sc" <!--#if $sc == $filter[2] then "selected" else ""#-->>$sc</option>
            <!--#end for#-->
            </select>
          </td>
        <!--#end if#-->
        <td>
        <input type="hidden" name="index" value="$fnum"/>
        <input type="hidden" name="feed" value="$feed"/>
        <input type="hidden" name="session" value="$session">
        <input type="submit" value="Save" onclick="javascript:submitconfig('config/rss/upd_rss_filter', '','$feed+$fnum','1' )"/>
        </td>

    </tr>
        <!--#set $fnum = $fnum+1#-->
    <!--#end for#-->
</tbody>
    </table>
    </fieldset>
    <br class="clear" /> <br class="clear" />
<!--#end for#-->

<!--#else#-->
    <p>
        <b>feedparser module missing<b>
    </p>
<!--#end if#-->



#summary Patched and extended rTorrent version.
<wiki:toc max_depth="2" />

= Introduction =

<table border="0"><tr valign="middle">
<td>https://pyroscope.googlecode.com/svn/trunk/pyrocore/src/pyrocore/data/img/rt-logo.png</td>
<td width="30px"></td>
<td><g:plusone size="tall" href="http://code.google.com/p/pyroscope/"></g:plusone><br />http://i.imgur.com/hAdjM.gif</td>
<td width="10px"></td>
<td><wiki:gadget url="http://www.ohloh.net/p/346666/widgets/project_users.xml?style=red" height="100"  border="0" /></td>
<td align="center">[http://youtu.be/Bv-oajBgsSU http://i.imgur.com/5FPx5.png]<br />  Demo Video</td>
</tr></table>

By installing the extended rTorrent distribution `rTorrent-PS`, you'll get an alternative rTorrent executable with the following changes:
 # self-contained install into any location of your choosing, including your home directory, offering the ability to run several versions at once (in different client instances).
 # _rpath-linked_ to the major dependencies, so you can upgrade those independently from your OS distribution's versions.
 # extended command set (exclusive PyroScope patches):
   * sort views by more than one value, and set the sort direction for each of these.
   * bind keys in the root display to any command, e.g. change the built-in views.
   * interface patches adding easily customizable colors, displaying the _tracker domain_, and some more minor modifications to the download list view.
 # show number of registered downloads on the tracker info panel.

You just need to either follow the [DebianInstallFromSource#rTorrent_installation build instructions], or download and install a package from [https://bintray.com/pkg/show/general/pyroscope/rtorrent-ps/rtorrent-ps Bintray] — assuming one is available for your platform.

http://i.imgur.com/xVSmh.png

The new stable rTorrent version *0.9.2* is built by default, but 0.8.9 and 0.8.6 are also supported (but not tested anymore) — also, not all patches are applied equally (depending on whether they're needed, or applicable at all).
Note that some of these patches are taken from the [https://aur.archlinux.org/packages/rtorrent-extended/ AUR package] provided for [http://www.archlinux.org/ Arch Linux]. Also, there is now a [https://aur.archlinux.org/packages.php?ID=54763 rtorrent-pyro] AUR package (which is said to not really work, contact its maintainers with any problems, _not_ me).

 ➽ _Note that you need to read *all* of the following explanations of the user-interface related new commands to get the visual changes set up correctly, since this requires some special setup of your terminal on many machines!_


= Additional features in the standard configuration =
If you followed the instructions in the _Extending your `.rtorrent.rc`_ section of the UserConfiguration page, you will get the following additional features in your `rTorrent-PS` installation:
 # the »`t`« key is bound to a `trackers` view that shows all items sorted by tracker and then by name.
 # the »`!`« key is bound to a `messages` view, listing all items that currently have a non-empty message, sorted in order of the message text.
 # the »`^`« key is bound to the `rtcontrol` search result view, so you can easily return to your last search.
 # »`*`« toggles between the collapsed (as described on RtorrentExtendedCanvas) and the expanded display of the current view. <br /><br /> http://i.imgur.com/zbAT9.png
 # The `active` view is changed to include all incomplete items regardless of whether they have any traffic, and then groups the list into complete, incomplete, and queued items, in that order. Within each group, they're sorted by download and then upload speed.
 # The commands `s=«keyword»`, `t=«tracker_alias»`, and `f=«filter_condition»` are pre-defined for searching using a Ctrl-X prompt. 
 # The »`.`« key toggles the membership in the `tagged` view for the item in focus, »`:`« shows the `tagged` view, and »`T`« clears that view (i.e. removes the tagged state on all items). This can be very useful to manually select a few items and then run `rtcontrol` on them, or alternatively use »`--to-view tagged`« to populate the `tagged` view, then deselect some items interactively with the »`.`« key, and finally mass-control the rest.
 # You can use the `purge=` and `cull=` commands (on a Ctrl-X prompt) for deleting the current item and its (incomplete) data.

 ✪ _Do not forget to set the value of `pyro.extended` to 1!_


= Command extensions =
The following new commands are available.

<dl>
<dt>
== `compare=order,command1=[,...]` ==
</dt>
<dd>
Compares two items like `less=` or `greater=`, but allows to compare
by several different sort criteria, and ascending or descending
order per given field. 

The first parameter is a string of order
indicators, either `aA+` for ascending or `dD-` for descending. 
The default, i.e. when there's more fields than indicators, is
ascending. Field types other than value or string are treated
as equal (or in other words, they're ignored).
If all fields are equal, then items are ordered in a random, but
stable fashion.

Configuration example:
{{{
# VIEW: Show active and incomplete torrents (in view #9) and update every 20 seconds
#       Items are grouped into complete, incomplete, and queued, in that order.
#       Within each group, they're sorted by upload and then download speed.
view_sort_current = active,"compare=----,d.is_open=,d.get_complete=,d.get_up_rate=,d.get_down_rate="
schedule = filter_active,12,20,"view_filter = active,\"or={d.get_up_rate=,d.get_down_rate=,not=$d.get_complete=}\" ;view_sort=active"
}}}
</dd>

<dt>
== `ui.bind_key=display,key,"command1=[,...]"` ==
</dt>
<dd>
<br /> *⚠ WARNING: This currently can NOT be used immediately when `rtorrent.rc` is parsed, so it has to be scheduled once shortly after startup (see below example).*

Binds the given key on a specified display to execute the commands when pressed.

 * `display` must be equal to `download_list` (currently, no other displays are supported).
 * `key` can be either a single character for normal keys, or `^` plus a character for control keys.

Configuration example:
{{{
# VIEW: Bind view #7 to the "rtcontrol" result
schedule = bind_7,0,0,"ui.bind_key=download_list,7,ui.current_view.set=rtcontrol"
}}}
</dd>

<dt>
== `view.collapsed.toggle=«VIEW NAME»` ==
</dt>
<dd>
This command changes between the normal item display where each item takes up three lines to a more condensed form where each item only takes up one line. Note that each view has its own state, and that if the view name is empty, the current view is toggled. You can set the default state in your configuration, by adding a toggle command for each view you want collapsed after startup (the default is expanded).

Also, you should bind the current view toggle to a key, like this:
{{{
schedule = bind_collapse,0,0,"ui.bind_key=download_list,*,view.collapsed.toggle="
}}}

Further explanations on what the columns show and what forms of abbreviations are used, to get a display as compact as possible while still showing all the important stuff, can be found on RtorrentExtendedCanvas. That page also contains hints on *how to correctly setup your terminal*.

</dd>

<dt>
== `ui.color.«TYPE».set="«COLOR DEF»"` ==
</dt>
<dd>
These commands allow you to set colors for selected elements of the user interface, in some cases depending on their status. You can either provide colors by specifying the numerical index in the terminal's color table, or by name (for the first 16 colors). The possible color names are "black", "red", "green", "yellow", "blue", "magenta", "cyan", "gray", and "white"; you can use them for both text and background color, in the form "«fg» on «bg»", and you can add "bright" in front of a color to select a more luminous version. If you don't specify a color, the default of your terminal is used.

Also, these additional modifiers can be placed in the color definitions, but it depends on the terminal you're using whether they have an effect: "bold", "standout", "underline", "reverse", "blink", and "dim".

Here's a configuration example showing all the commands and their defaults:

{{{
# UI/VIEW: Colors
ui.color.alarm.set="bold white on red"
ui.color.complete.set="bright green"
ui.color.even.set=""
ui.color.focus.set="reverse"
ui.color.footer.set="bold bright cyan on blue"
ui.color.incomplete.set="yellow"
ui.color.info.set="white"
ui.color.label.set="gray"
ui.color.leeching.set="bold bright yellow"
ui.color.odd.set=""
ui.color.progress0.set="red"
ui.color.progress20.set="bold bright red"
ui.color.progress40.set="bold bright magenta"
ui.color.progress60.set="yellow"
ui.color.progress80.set="bold bright yellow"
ui.color.progress100.set="green"
ui.color.progress120.set="bold bright green"
ui.color.queued.set="magenta"
ui.color.seeding.set="bold bright green"
ui.color.stopped.set="blue"
ui.color.title.set="bold bright white on blue"
}}}

Note that you might need to enable support for 256 colors in your terminal, see [http://askubuntu.com/questions/67/how-do-i-enable-full-color-support-in-terminal this article] for a description. In a nutshell, you need to install the `ncurses-term` package if you don't have it already, and also add these commands to your rTorrent start script:

{{{
if [ "$TERM" = "${TERM%-256color}" ]; then
    export TERM="$TERM-256color"
fi
}}}

Also consider the hints at the end of the RtorrentExtendedCanvas page.

If everything worked so far, and you now want to find you own coloring theme, the easiest way is to use a second shell and `rtxmlrpc`. Try out some colors, and add the combinations you like to your `~/.rtorrent.rc`.

{{{
# For people liking candy stores...
rtxmlrpc ui.color.title.set "bold magenta on bright cyan"
}}}


The [http://pyroscope.googlecode.com/svn/trunk/pyrocore/docs/rtorrent-extended/term-256color.py term-256color] script can help you with showing the colors your terminal supports, an example output using Gnome's terminal looks like the following...

http://i.imgur.com/iu8nY.png
</dd>

<dt>
== `d.tracker_domain=` ==
</dt>
<dd>
Returns the (shortened) _tracker domain_ of the given download item. The chosen tracker is the first HTTP one with active peers (seeders or leechers), or else the first one.
</dd>

<dt>
== `ui.current_view=` ==
</dt>
<dd>
Returns the currently selected view, the official release only has a setter. Needed if you want to use »`-`« as a view name in `rtcontrol`.
</dd>

<dt>
== `log.messages=«path»` (0.8.9+ only) ==
</dt>
<dd>
(Re-)opens a log file that contains the messages normally only visible on the main panel and via the `l` key. Each line is prefixed with the current date and time in ISO8601 format.
If an empty path is passed, the file is closed.
</dd>

<dt>
== `network.history.*=` (0.8.9+ only) ==
</dt>
<dd>
Commands to add network traffic charts to the bottom of the collapsed download display.
The commands added are `network.history.depth[.set]=`,  `network.history.sample=`,  `network.history.refresh=`, and `network.history.auto_scale=`.
See the RtorrentExtendedCanvas page on how to use them.
</dd>

</dl>


= Backports of 0.8.8 features to 0.8.6 =
The following features of newer versions are patched into the 0.8.6 version of rTorrent-PS:
 * [http://libtorrent.rakshasa.no/changeset/1206 Changeset #1206]: `network.http.ssl_verify_peer.set` used to disable checking of self-signed SSL certificates.

= Backports of git `master` fixes and features to 0.8.9 =
The following fixes and features of the development version are patched into the 0.8.9 version of rTorrent-PS:

 * a fix in libtorrent for a problem located in the epoll event handling code (#1246).
 * fixed check of the XML-RPC task queue length (#1246).
 * a possible busy loop when trying to interrupt the main loop (#1263).
 * `log.execute` is fixed, and stays open.
 * no more zombies with `execute.*.bg`.
 * backports of these new commands: `d.chunks_seen`, `t.is_usable`, and `t.is_busy`.


= Backports of git `master` fixes and features to 0.9.2 =
The following fixes and features of the development version are patched into the 0.9.2 version of rTorrent-PS:
 * [https://github.com/rakshasa/rtorrent/commit/b79dea94b2f537eda620ed48207369c076fcd11f Wait for disowned HTTP requests to finish, to ensure stopped event gets sent to tracker on client shutdown].
 * Also, the broken announce interval handling is fixed.